{% extends "questionnaires/base.html" %}
{% block title %}Questionnaire{% endblock %}
{% block header %}
<link rel="stylesheet" href="https://code.jquery.com/mobile/1.4.5/jquery.mobile-1.4.5.min.css">
<script src="https://code.jquery.com/mobile/1.4.5/jquery.mobile-1.4.5.min.js"></script>
{% endblock %}
{% block content %}
{% load i18n %}
{% block head %}
{{ wizard.form.media }}
{% endblock %}


<div data-role="page" class="progress">
    <div class="progress-bar" role="progressbar"
         aria-valuenow="{% widthratio wizard.steps.step1 wizard.steps.count 100 %}" aria-valuemin="0"
         aria-valuemax="100" style="width:{% widthratio wizard.steps.step1 wizard.steps.count 100 %}%">
        {% widthratio wizard.steps.step1 wizard.steps.count 100 %}&#37;
    </div>
    {% if wizard.steps.next %}
    <img class="progressicon" src="/static/qtab/img/Squirrel.ico" height="60px" width="60px" />
    {% endif %}
</div>
<div style="background-color:{{wizard.form.qbgcolor}}; color:{{wizard.form.textcolor}};">
    <p>Question {{ wizard.steps.step1 }} of {{ wizard.steps.count }}</p>
    <form action="" method="post">{% csrf_token %}

        <div class="container-responsive ui-content" align="center">
            {{ wizard.management_form }}
            {% if wizard.form.forms %}
                {{ wizard.form.management_form }}

                {% for form in wizard.form.forms %}
                {{ form }}
                {% endfor %}
            {% else %}

            <div class="row">
                <div class="col-xs-2">&nbsp;</div>
                <div class="col-xs-8 form-group" align="center">
                    {{ wizard.form.non_field_errors }}
                    {% if wizard.form.qimage %}
                    <img src="/media/{{ wizard.form.qimage }}" width="400px"
                         alt="{{wizard.form.question.label}}"/><br/>
                    {% endif %}
    {% if wizard.form.question.field.choices %}

                     <label><h3>{{wizard.form.question.label}}</h3></label>
                    {% if wizard.form.question.errors %}
                    <p>{{ wizard.form.question.errors.as_ul }}</p>
                    {% endif %}


          {% if wizard.form.question.help_text == 'select' %}
                <select class="form-control" id="{{ wizard.form.question.id_for_label}}"
                                        name="{{wizard.form.prefix}}-{{ wizard.form.question.name }}">
                                {% for choice in wizard.form.question.field.choices %}
                                <option value="{{ choice.0 }}">{{choice.1.choice_text}}</option>
                                {% endfor %}
                            </select>

          {% else %}
            {% if wizard.form.usegrid %}
                    <table id="qtable" class="table"> <tbody> <tr>
                        {% else %}
                        <div class="radio-list">
            {% endif %}
            {% for choice in wizard.form.question.field.choices %}
            {% if wizard.form.usegrid %}<td></td><td class="{{wizard.form.tdcss}} color{{forloop.counter}}">
            {%else %} <div class="radio-default">{% endif %}
                <label><input type="{{wizard.form.question.help_text}}"
                              id="{{ wizard.form.question.id_for_label}}"
                              name="{{wizard.form.prefix}}-{{ wizard.form.question.name }}"
                              value="{{ choice.0 }}"
                  {% if choice.1.choice_image %}
                              class="imageradio"> <img src="/media/{{choice.1.choice_image }}"
                                                       title="{{choice.1.choice_text}}"/>
                    {% else %}
                    />
                    {% endif %}

                    {% if choice.1.show_label %}{{ choice.1.choice_text }}{% endif %}
                </label>
            {% if wizard.form.usegrid %}</td>
                {% if forloop.counter|divisibleby:"3"%}</tr><tr>{% endif %}
            {%else %}</div>
            {% endif %}

           {% endfor %}


            {% if wizard.form.usegrid %}</tr></tbody></table> {% else %} </div>{%endif%}
{% endif %}

    {% else %}
                    <h3>{{wizard.form.question.field.label}}</h3>
                    {{wizard.form.question}}
    {% endif %}


                </div>
                <div class="col-xs-2">&nbsp;</div>
            </div>



            <div class="row">
                <div class="col-xs-2">&nbsp;</div>
                <div class="col-xs-8" align="center">
                    <span id="msg"></span>
                    <ul class="pager">
                        {% if wizard.steps.prev %}
                        <li class="previous">
                            <button name="wizard_goto_step" class="btn btn-default" type="submit"
                                    value="{{ wizard.steps.first }}">{% trans "Restart" %}
                            </button>
                        </li>
                        <li class="previous">
                            <button name="wizard_goto_step" class="btn btn-default" type="submit"
                                    value="{{ wizard.steps.prev }}">{% trans "Previous" %}
                            </button>
                        </li>
                        {% endif %}
                        <li class="next">
                            {% if wizard.steps.next %}
                                <input type="submit" class="btn btn-info" value="Next"/>
                            {% else %}
                                <input type="submit" class="btn btn-info" value="Finish"/>
                            {% endif %}
                        </li>
                    </ul>
                </div>
                <div class="col-xs-2">&nbsp;</div>
            </div>
            {% endif %}
        </div>
   </form>
</div>
<script type="text/javascript">

$( "td.coloredbox :input:radio" ).click(function() {
        var choice = $(this).val();
        var color = $( this ).parent().parent().css( "opacity" );
        $( "#msg" ).text( "You selected: " + choice );
        $("td.coloredbox").css("opacity",0.6);
        $( this ).parent().parent().css( "opacity",1.0 );
        /*.show().fadeOut( 1000 );*/

});
var selected = [];

$( "td.coloredbox :input:checkbox" ).click(function() {
        var choice = $(this).val();
        var color = $( this ).parent().parent().css( "opacity" );
        var data = $("#msg" ).text();
        var arr = data.split(':');
        if ($(this).prop('checked')){
            selected.push(choice);
            $( this ).parent().parent().css( "opacity",1.0 );
        }else{
            selected.splice( $.inArray(choice, selected), 1 );
            $( this ).parent().parent().css( "opacity",0.6);
        }
        $( "#msg" ).text( "You selected: " + selected.toString()  );

        /*.show().fadeOut( 1000 );*/

});


</script>
{% endblock content %}
